<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin - Reservas y Contacto | Sabor al Instante</title>

<script>
    // Bloqueo de acceso sin sesión
    const sesion = JSON.parse(localStorage.getItem("session"));
    if (!sesion) location.href = "login.html";
</script>

<!-- FontAwesome -->
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

<style>
/* ------------ VARIABLES ------------ */
:root{
  --bg:#0e0e0e;
  --card:#1a1a1a;
  --card-light:#222;
  --text:#f5f5f5;
  --text-muted:#b8b8b8;
  --gold:#d4c59e;
  --gold-dark:#bba87c;
  --accent:#8fae56;
  --danger:#d93636;
  --radius:18px;
  --shadow:0 8px 35px rgba(0,0,0,.35);
  --shadow-soft:0 4px 18px rgba(0,0,0,.25);
  font-family:"Poppins", system-ui;
}

*{ box-sizing:border-box; margin:0; padding:0; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-top:80px;
}

/* ============ HEADER ============ */
header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(30, 30, 30, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.container.header-expand {
    max-width: 1400px;
    margin: 0 auto;
    padding: 15px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 30px;
}

.container-logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.container-logo img {
    width: 45px;
    height: 45px;
}

.container-logo span {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--gold);
    text-transform: lowercase;
}

nav ul {
    display: flex;
    list-style: none;
    gap: 30px;
}

nav a {
    color: var(--text);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s;
}

nav a:hover {
    color: var(--gold);
}

.btn-cerrar {
    background: #b84040;
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    box-shadow: var(--shadow-soft);
    transition: 0.3s;
}

.btn-cerrar:hover {
    background: #a03030;
}

.btn-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--text);
    font-size: 1.5rem;
    cursor: pointer;
}

.menu-responsive {
    display: none;
}

/* WRAPPER */
.wrap{
  width:93%;
  max-width:1200px;
  margin:40px auto;
}

/* PANEL */
.panel{
  background:var(--card);
  padding:28px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.06);
}

/* TOP ROW */
.top-row{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  align-items:center;
  justify-content:space-between;
}

.title{
  font-size:24px;
  font-weight:700;
  color:var(--gold);
}

/* CONTROLS */
.controls {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.controls select,
.controls input{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:var(--card-light);
  color:var(--text);
}

.controls input{ width:320px; }

.btn{
  background:var(--gold);
  color:#000;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  font-weight:700;
  transition: 0.3s;
}

.btn:hover{
  background:var(--gold-dark);
}

/* TABLE */
.table-wrap{
  margin-top:20px;
  border-radius:var(--radius);
  overflow:auto;
  background:rgba(255,255,255,.04);
  backdrop-filter:blur(6px);
  box-shadow:var(--shadow-soft);
}

table{
  width:100%;
  border-collapse:collapse;
}

th{
  background:var(--card-light);
  padding:14px;
  text-align:left;
  color:var(--gold);
  position:sticky;
  top:0;
}

td{
  padding:14px;
  color:var(--text-muted);
  border-bottom:1px solid rgba(255,255,255,.05);
}

.actions button{
  padding:8px 10px;
  border:none;
  cursor:pointer;
  border-radius:12px;
  color:#fff;
  transition: 0.3s;
}
.actions .view{ background:#4a90d9; }
.actions .view:hover{ background:#3a7bc8; }
.actions .edit{ background:#c28c2a; }
.actions .edit:hover{ background:#b07a1a; }
.actions .delete{ background:#d93636; }
.actions .delete:hover{ background:#c82626; }

/* NO DATA */
.no-data{
  padding:30px;
  text-align:center;
  color:var(--text-muted);
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding: 20px;
}

.modal.show{ display:flex; }

.modal-card{
  width:100%;
  max-width:700px;
  background:var(--card);
  padding:30px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  max-height: 90vh;
  overflow-y: auto;
}

.modal-card h3 {
  color: var(--gold);
  margin-bottom: 20px;
  font-size: 1.5rem;
}

.field{ 
  display:flex; 
  flex-direction:column; 
  margin-bottom:15px;
}

.field label {
  margin-bottom: 6px;
  color: var(--text);
  font-weight: 500;
}

.field input,
.field select,
.field textarea{
  padding:12px;
  border-radius:14px;
  background:var(--card-light);
  border:1px solid rgba(255,255,255,.1);
  color:#fff;
  font-family: inherit;
}

.field input:disabled,
.field select:disabled,
.field textarea:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

textarea{ 
  min-height:120px;
  resize: vertical;
}

.modal-actions{
  margin-top:25px;
  display:flex;
  justify-content:flex-end;
  gap:12px;
}

.btn-cancel {
  background: #666;
  color: #fff;
}

.btn-cancel:hover {
  background: #555;
}

/* ALERT */
.alert{
  position:fixed;
  right:20px;
  bottom:20px;
  padding:16px 22px;
  border-radius:14px;
  display:none;
  box-shadow: var(--shadow);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
  animation: slideIn 0.3s ease;
  z-index: 10000;
}

.alert.success {
  background: rgba(143, 174, 86, 0.95);
  color: #000;
  border: 1px solid rgba(143, 174, 86, 0.3);
}

.alert.error {
  background: rgba(220, 53, 69, 0.95);
  color: #fff;
  border: 1px solid rgba(220, 53, 69, 0.3);
}

.alert i {
  font-size: 1.2rem;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* MODAL DE CONFIRMACIÓN */
.modal-confirm {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  padding: 20px;
}

.modal-confirm.show {
  display: flex;
}

.confirm-card {
  background: var(--card);
  padding: 30px;
  border-radius: var(--radius);
  max-width: 450px;
  width: 100%;
  box-shadow: var(--shadow);
  text-align: center;
  animation: scaleIn 0.3s ease;
}

.confirm-card .icon-warning {
  font-size: 3.5rem;
  color: #f59e0b;
  margin-bottom: 15px;
}

.confirm-card h3 {
  color: var(--gold);
  margin-bottom: 10px;
  font-size: 1.4rem;
}

.confirm-card p {
  color: var(--text-muted);
  margin-bottom: 25px;
  line-height: 1.5;
}

.confirm-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.btn-confirm-yes {
  background: #d93636;
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.btn-confirm-yes:hover {
  background: #c82626;
}

.btn-confirm-no {
  background: #666;
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.btn-confirm-no:hover {
  background: #555;
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .container.header-expand {
        padding: 15px 20px;
    }
    
    nav {
        display: none;
    }
    
    .btn-cerrar {
        position: static;
    }
    
    .controls input {
        width: 100%;
    }
    
    .top-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .controls {
        flex-direction: column;
    }
}
</style>
</head>
<body>

<header>
    <div class="container header-expand">
        <div class="container-logo">
            <img src="images/logo.svg" alt="Logo" />
            <span>sabor al instante</span>
        </div>

        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="sobrenosotros.html">Acerca</a></li>
                <li><a href="lista.html">Servicios</a></li>
                <li><a href="menu.html">Menú</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
        </nav>

        <button onclick="cerrarSesion()" class="btn-cerrar">
            Cerrar sesión
        </button>
    </div>
</header>

<div class="wrap">
  <div class="panel">

    <div class="top-row">
      <div class="title">Gestión — Reservas y Mensajes</div>

      <div class="controls">
        <select id="viewSelect">
          <option value="reservas">Reservas</option>
          <option value="mensajes">Mensajes</option>
        </select>

        <input id="searchInput" type="text" placeholder="Buscar...">
        <button id="btnNew" class="btn">+ Nuevo</button>
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div id="noData" class="no-data" style="display:none">No hay registros.</div>

  </div>
</div>

<!-- MODAL VER RESERVA -->
<div id="modalReserva" class="modal">
  <div class="modal-card">
    <h3>Detalle de Reserva</h3>

    <div class="field">
      <label>Nombre</label>
      <input id="resNombre" disabled>
    </div>

    <div class="field">
      <label>Correo</label>
      <input id="resCorreo" disabled>
    </div>

    <div class="field">
      <label>Teléfono</label>
      <input id="resTelefono" disabled>
    </div>

    <div class="field">
      <label>Fecha</label>
      <input id="resFecha" type="date" disabled>
    </div>

    <div class="field">
      <label>Hora</label>
      <input id="resHora" disabled>
    </div>

    <div class="field">
      <label>Personas</label>
      <input id="resPersonas" disabled>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" onclick="closeModalReserva()">Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL VER MENSAJE -->
<div id="modalMensaje" class="modal">
  <div class="modal-card">
    <h3>Detalle de Mensaje</h3>

    <div class="field">
      <label>Nombre</label>
      <input id="msgNombre" disabled>
    </div>

    <div class="field">
      <label>Correo</label>
      <input id="msgCorreo" disabled>
    </div>

    <div class="field">
      <label>Teléfono</label>
      <input id="msgTelefono" disabled>
    </div>

    <div class="field">
      <label>Mensaje</label>
      <textarea id="msgTexto" disabled></textarea>
    </div>

    <!-- Sección de respuestas -->
    <div id="respuestasContainer" style="margin-top: 20px;">
      <h4 style="color: var(--gold); margin-bottom: 15px; font-size: 1.1rem;">
        <i class="fa-solid fa-reply"></i> Respuestas
      </h4>
      <div id="respuestasLista" style="margin-bottom: 15px;"></div>
      
      <div class="field">
        <label>Nueva respuesta</label>
        <textarea id="nuevaRespuesta" placeholder="Escribe tu respuesta aquí..." style="min-height: 80px;"></textarea>
      </div>
      <button class="btn" onclick="agregarRespuesta()" style="width: 100%; margin-top: 10px;">
        <i class="fa-solid fa-paper-plane"></i> Enviar Respuesta
      </button>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" onclick="closeModalMensaje()">Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR RESERVA -->
<div id="modalEditarReserva" class="modal">
  <div class="modal-card">
    <h3>Editar Reserva</h3>

    <div class="field">
      <label>Nombre</label>
      <input id="editResNombre">
    </div>

    <div class="field">
      <label>Correo</label>
      <input id="editResCorreo" type="email">
    </div>

    <div class="field">
      <label>Teléfono</label>
      <input id="editResTelefono" type="tel">
    </div>

    <div class="field">
      <label>Fecha</label>
      <input id="editResFecha" type="date">
    </div>

    <div class="field">
      <label>Hora</label>
      <select id="editResHora">
        <option>10:00 AM</option>
        <option>11:00 AM</option>
        <option>12:00 PM</option>
        <option>01:00 PM</option>
        <option>02:00 PM</option>
        <option>03:00 PM</option>
        <option>04:00 PM</option>
        <option>05:00 PM</option>
        <option>06:00 PM</option>
        <option>07:00 PM</option>
        <option>08:00 PM</option>
        <option>09:00 PM</option>
      </select>
    </div>

    <div class="field">
      <label>Personas</label>
      <select id="editResPersonas">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
        <option>10</option>
        <option>15</option>
        <option>20</option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" onclick="closeModalEditarReserva()">Cancelar</button>
      <button class="btn" id="saveEditarReservaBtn">Guardar Cambios</button>
    </div>
  </div>
</div>

<!-- MODAL NUEVA RESERVA -->
<div id="modalNuevaReserva" class="modal">
  <div class="modal-card">
    <h3>Nueva Reserva</h3>

    <div class="field">
      <label>Nombre</label>
      <input id="newResNombre">
    </div>

    <div class="field">
      <label>Correo</label>
      <input id="newResCorreo" type="email">
    </div>

    <div class="field">
      <label>Teléfono</label>
      <input id="newResTelefono" type="tel">
    </div>

    <div class="field">
      <label>Fecha</label>
      <input id="newResFecha" type="date">
    </div>

    <div class="field">
      <label>Hora</label>
      <select id="newResHora">
        <option value="">Selecciona una hora</option>
        <option>10:00 AM</option>
        <option>11:00 AM</option>
        <option>12:00 PM</option>
        <option>01:00 PM</option>
        <option>02:00 PM</option>
        <option>03:00 PM</option>
        <option>04:00 PM</option>
        <option>05:00 PM</option>
        <option>06:00 PM</option>
        <option>07:00 PM</option>
        <option>08:00 PM</option>
        <option>09:00 PM</option>
      </select>
    </div>

    <div class="field">
      <label>Personas</label>
      <select id="newResPersonas">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
        <option>10</option>
        <option>15</option>
        <option>20</option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" onclick="closeModalNuevaReserva()">Cancelar</button>
      <button class="btn" id="saveNuevaReservaBtn">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL NUEVO MENSAJE -->
<div id="modalNuevoMensaje" class="modal">
  <div class="modal-card">
    <h3>Nuevo Mensaje</h3>

    <div class="field">
      <label>Nombre</label>
      <input id="newMsgNombre">
    </div>

    <div class="field">
      <label>Correo</label>
      <input id="newMsgCorreo" type="email">
    </div>

    <div class="field">
      <label>Teléfono</label>
      <input id="newMsgTelefono" type="tel">
    </div>

    <div class="field">
      <label>Mensaje</label>
      <textarea id="newMsgTexto"></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" onclick="closeModalNuevoMensaje()">Cancelar</button>
      <button class="btn" id="saveNuevoMensajeBtn">Guardar</button>
    </div>
  </div>
</div>

<div id="alertBox" class="alert"></div>

<!-- MODAL DE CONFIRMACIÓN -->
<div id="modalConfirm" class="modal-confirm">
  <div class="confirm-card">
    <i class="fa-solid fa-triangle-exclamation icon-warning"></i>
    <h3 id="confirmTitle">¿Estás seguro?</h3>
    <p id="confirmMessage">Esta acción no se puede deshacer.</p>
    <div class="confirm-actions">
      <button class="btn-confirm-no" onclick="closeConfirm()">Cancelar</button>
      <button class="btn-confirm-yes" id="confirmYesBtn">Eliminar</button>
    </div>
  </div>
</div>

<script>
/* ============================
   DATOS
============================ */
let reservas = JSON.parse(localStorage.getItem("reservas")) || [];
let mensajes = JSON.parse(localStorage.getItem("mensajesContacto")) || [];

const viewSelect = document.getElementById("viewSelect");
const searchInput = document.getElementById("searchInput");
const btnNew = document.getElementById("btnNew");
const thead = document.getElementById("thead");
const tbody = document.getElementById("tbody");
const noData = document.getElementById("noData");

/* ============================
   FUNCIONES GENERALES
============================ */
function cerrarSesion(){
    localStorage.removeItem("session");
    location.href = "login.html";
}

function showAlert(msg, tipo = 'success'){
    const a = document.getElementById("alertBox");
    
    // Limpiar clases anteriores
    a.className = 'alert';
    a.classList.add(tipo);
    
    // Agregar icono según el tipo
    const icono = tipo === 'error' ? 'fa-circle-xmark' : 'fa-circle-check';
    a.innerHTML = `<i class="fa-solid ${icono}"></i><span>${msg}</span>`;
    
    a.style.display = "flex";
    setTimeout(()=> {
        a.style.opacity = '0';
        setTimeout(() => {
            a.style.display = "none";
            a.style.opacity = '1';
        }, 300);
    }, 4000);
}

// Modal de confirmación
let confirmCallback = null;

function showConfirm(title, message, onConfirm){
    document.getElementById("confirmTitle").textContent = title;
    document.getElementById("confirmMessage").textContent = message;
    confirmCallback = onConfirm;
    document.getElementById("modalConfirm").classList.add("show");
}

function closeConfirm(){
    document.getElementById("modalConfirm").classList.remove("show");
    confirmCallback = null;
}

document.getElementById("confirmYesBtn").onclick = ()=>{
    if(confirmCallback) confirmCallback();
    closeConfirm();
};

// VERIFICAR DISPONIBILIDAD DE RESERVAS (MÁXIMO 10 POR DÍA Y HORA)
function verificarDisponibilidadAdmin(fecha, hora, idExcluir = null) {
    const todasReservas = JSON.parse(localStorage.getItem('reservas')) || [];
    
    // Filtrar reservas para esa fecha y hora (excluyendo la que se está editando)
    const reservasEnFechaYHora = todasReservas.filter(r => 
        r.fecha === fecha && 
        r.hora === hora && 
        r.id !== idExcluir
    );
    
    if (reservasEnFechaYHora.length >= 2) {
        return { 
            disponible: false, 
            mensaje: "Ya no hay disponibilidad para esa fecha y hora. Por favor selecciona otra hora o día." 
        };
    }
    
    return { disponible: true };
}

// VERIFICAR DISPONIBILIDAD DE RESERVAS (MÁXIMO 10 POR DÍA Y HORA)
function verificarDisponibilidadAdmin(fecha, hora, idExcluir = null) {
    const todasReservas = JSON.parse(localStorage.getItem('reservas')) || [];
    
    // Filtrar reservas para esa fecha y hora (excluyendo la que se está editando)
    const reservasEnFechaYHora = todasReservas.filter(r => 
        r.fecha === fecha && 
        r.hora === hora && 
        r.id !== idExcluir
    );
    
    if (reservasEnFechaYHora.length >= 2) {
        return { 
            disponible: false, 
            mensaje: "Ya no hay disponibilidad para esa fecha y hora. Por favor selecciona otra hora o día." 
        };
    }
    
    return { disponible: true };
}

/* ============================
   RENDERIZADO
============================ */
function render(){
    if(viewSelect.value === "reservas") renderReservas();
    else renderMensajes();
}

/* RESERVAS */
function renderReservas(){
    thead.innerHTML = `
      <tr>
        <th>Nombre</th><th>Correo</th><th>Teléfono</th>
        <th>Fecha</th><th>Hora</th><th>Personas</th><th>Acciones</th>
      </tr>
    `;

    const q = searchInput.value.toLowerCase();
    const list = reservas.filter(r =>
        r.nombre.toLowerCase().includes(q) ||
        r.correo.toLowerCase().includes(q) ||
        r.telefono.toLowerCase().includes(q)
    );

    tbody.innerHTML = "";
    if(list.length === 0){ noData.style.display="block"; return; }
    noData.style.display="none";

    list.forEach(r=>{
        tbody.innerHTML += `
          <tr>
            <td>${r.nombre}</td>
            <td>${r.correo}</td>
            <td>${r.telefono}</td>
            <td>${r.fecha}</td>
            <td>${r.hora}</td>
            <td>${r.personas}</td>
            <td class="actions">
              <button class="view" onclick="viewReserva('${r.id}')"><i class="fa fa-eye"></i></button>
              <button class="edit" onclick="editReserva('${r.id}')"><i class="fa fa-pen"></i></button>
              <button class="delete" onclick="deleteReserva('${r.id}')"><i class="fa fa-trash"></i></button>
            </td>
          </tr>
        `;
    });
}

/* MENSAJES */
function renderMensajes(){
    thead.innerHTML = `
      <tr>
        <th>Nombre</th><th>Correo</th><th>Teléfono</th>
        <th>Mensaje</th><th>Acciones</th>
      </tr>
    `;

    const q = searchInput.value.toLowerCase();
    const list = mensajes.filter(m =>
        m.nombre.toLowerCase().includes(q) ||
        m.correo.toLowerCase().includes(q) ||
        m.telefono.toLowerCase().includes(q) ||
        m.mensaje.toLowerCase().includes(q)
    );

    tbody.innerHTML = "";
    if(list.length === 0){ noData.style.display="block"; return; }
    noData.style.display="none";

    list.forEach(m=>{
        tbody.innerHTML += `
          <tr>
            <td>${m.nombre}</td>
            <td>${m.correo}</td>
            <td>${m.telefono}</td>
            <td>${m.mensaje.substring(0, 50)}${m.mensaje.length > 50 ? '...' : ''}</td>
            <td class="actions">
              <button class="view" onclick="viewMensaje('${m.id}')"><i class="fa fa-eye"></i></button>
              <button class="delete" onclick="deleteMensaje('${m.id}')"><i class="fa fa-trash"></i></button>
            </td>
          </tr>
        `;
    });
}

/* ============================
   MODALES — VER RESERVA
============================ */
const modalReserva = document.getElementById("modalReserva");

function viewReserva(id){
    const r = reservas.find(x=> x.id === id);
    if(!r) return;

    document.getElementById("resNombre").value = r.nombre;
    document.getElementById("resCorreo").value = r.correo;
    document.getElementById("resTelefono").value = r.telefono;
    document.getElementById("resFecha").value = r.fecha;
    document.getElementById("resHora").value = r.hora;
    document.getElementById("resPersonas").value = r.personas;

    modalReserva.classList.add("show");
}

function closeModalReserva(){
    modalReserva.classList.remove("show");
}

function deleteReserva(id){
    showConfirm(
        "¿Eliminar reserva?",
        "Esta acción no se puede deshacer. La reserva será eliminada permanentemente.",
        () => {
            reservas = reservas.filter(r=> r.id !== id);
            localStorage.setItem("reservas", JSON.stringify(reservas));
            render();
            showAlert("Reserva eliminada exitosamente");
        }
    );
}

/* ============================
   MODALES — VER MENSAJE
============================ */
const modalMensaje = document.getElementById("modalMensaje");
let currentMensajeId = null;

function viewMensaje(id){
    const m = mensajes.find(x=> x.id === id);
    if(!m) return;

    currentMensajeId = id;

    document.getElementById("msgNombre").value = m.nombre;
    document.getElementById("msgCorreo").value = m.correo;
    document.getElementById("msgTelefono").value = m.telefono;
    document.getElementById("msgTexto").value = m.mensaje;
    
    // Cargar respuestas
    cargarRespuestas(m);

    modalMensaje.classList.add("show");
}

function cargarRespuestas(mensaje){
    const respuestasLista = document.getElementById("respuestasLista");
    
    if(!mensaje.respuestas || mensaje.respuestas.length === 0){
        respuestasLista.innerHTML = '<p style="color: var(--text-muted); font-style: italic;">Sin respuestas aún</p>';
        return;
    }
    
    respuestasLista.innerHTML = mensaje.respuestas.map(r => `
        <div style="
            background: rgba(143, 174, 86, 0.1);
            border-left: 3px solid var(--accent);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="color: var(--gold); font-weight: 600; font-size: 0.9rem;">
                    <i class="fa-solid fa-user-tie"></i> Administrador
                </span>
                <span style="color: var(--text-muted); font-size: 0.85rem;">
                    ${r.fecha}
                </span>
            </div>
            <p style="color: var(--text); margin: 0; line-height: 1.5;">
                ${r.texto}
            </p>
        </div>
    `).join('');
}

function agregarRespuesta(){
    const textoRespuesta = document.getElementById("nuevaRespuesta").value.trim();
    
    if(!textoRespuesta){
        showAlert("Por favor escribe una respuesta", 'error');
        return;
    }
    
    const mensaje = mensajes.find(m => m.id === currentMensajeId);
    if(!mensaje) return;
    
    if(!mensaje.respuestas){
        mensaje.respuestas = [];
    }
    
    mensaje.respuestas.push({
        texto: textoRespuesta,
        fecha: new Date().toLocaleString()
    });
    
    localStorage.setItem("mensajesContacto", JSON.stringify(mensajes));
    
    // Limpiar textarea
    document.getElementById("nuevaRespuesta").value = "";
    
    // Recargar respuestas
    cargarRespuestas(mensaje);
    
    showAlert("Respuesta enviada exitosamente");
}

function closeModalMensaje(){
    modalMensaje.classList.remove("show");
    currentMensajeId = null;
    document.getElementById("nuevaRespuesta").value = "";
}

function deleteMensaje(id){
    showConfirm(
        "¿Eliminar mensaje?",
        "Esta acción no se puede deshacer. El mensaje será eliminado permanentemente.",
        () => {
            mensajes = mensajes.filter(m=> m.id !== id);
            localStorage.setItem("mensajesContacto", JSON.stringify(mensajes));
            render();
            showAlert("Mensaje eliminado exitosamente");
        }
    );
}

/* ============================
   MODALES — EDITAR RESERVA
============================ */
const modalEditarReserva = document.getElementById("modalEditarReserva");
let editingReservaId = null;

function editReserva(id){
    const r = reservas.find(x=> x.id === id);
    if(!r) return;

    editingReservaId = id;

    document.getElementById("editResNombre").value = r.nombre;
    document.getElementById("editResCorreo").value = r.correo;
    document.getElementById("editResTelefono").value = r.telefono;
    document.getElementById("editResFecha").value = r.fecha;
    document.getElementById("editResHora").value = r.hora;
    document.getElementById("editResPersonas").value = r.personas;

    modalEditarReserva.classList.add("show");
}

function closeModalEditarReserva(){
    modalEditarReserva.classList.remove("show");
    editingReservaId = null;
}

document.getElementById("saveEditarReservaBtn").onclick = ()=>{
    if(!editingReservaId) return;

    const fecha = document.getElementById("editResFecha").value;
    const hora = document.getElementById("editResHora").value;

    // Validar que la fecha no haya pasado
    const fechaObj = new Date(fecha + 'T00:00:00');
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);

    if(fechaObj < hoy){
        showAlert("No puedes reservar en una fecha pasada. Por favor selecciona una fecha futura.", 'error');
        return;
    }

    // Validar que no sea domingo
    if(fechaObj.getDay() === 0){
        showAlert("Lo sentimos, los domingos estamos cerrados. Por favor selecciona otro día.", 'error');
        return;
    }

    // Verificar disponibilidad (excluyendo la reserva actual que se está editando)
    const disponibilidad = verificarDisponibilidadAdmin(fecha, hora, editingReservaId);
    if (!disponibilidad.disponible) {
        showAlert(disponibilidad.mensaje, 'error');
        return;
    }

    const data = {
        id: editingReservaId,
        nombre: document.getElementById("editResNombre").value.trim(),
        correo: document.getElementById("editResCorreo").value.trim(),
        telefono: document.getElementById("editResTelefono").value.trim(),
        fecha: fecha,
        hora: hora,
        personas: document.getElementById("editResPersonas").value,
        creado: reservas.find(r => r.id === editingReservaId).creado
    };

    if(!data.nombre || !data.correo || !data.telefono || !data.fecha || !data.hora){
        showAlert("Por favor completa todos los campos", 'error');
        return;
    }

    reservas = reservas.map(r => r.id === editingReservaId ? data : r);
    localStorage.setItem("reservas", JSON.stringify(reservas));
    closeModalEditarReserva();
    render();
    showAlert("Reserva actualizada exitosamente");
};

/* ============================
   MODALES — NUEVA RESERVA
============================ */
const modalNuevaReserva = document.getElementById("modalNuevaReserva");

function openNuevaReserva(){
    document.getElementById("newResNombre").value = "";
    document.getElementById("newResCorreo").value = "";
    document.getElementById("newResTelefono").value = "";
    document.getElementById("newResFecha").value = "";
    document.getElementById("newResHora").value = "";
    document.getElementById("newResPersonas").value = "2";

    modalNuevaReserva.classList.add("show");
}

function closeModalNuevaReserva(){
    modalNuevaReserva.classList.remove("show");
}

document.getElementById("saveNuevaReservaBtn").onclick = ()=>{
    const fecha = document.getElementById("newResFecha").value;
    const hora = document.getElementById("newResHora").value;

    // Validar que la fecha no haya pasado
    const fechaObj = new Date(fecha + 'T00:00:00');
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);

    if(fechaObj < hoy){
        showAlert("No puedes reservar en una fecha pasada. Por favor selecciona una fecha futura.", 'error');
        return;
    }

    // Validar que no sea domingo
    if(fechaObj.getDay() === 0){
        showAlert("Lo sentimos, los domingos estamos cerrados. Por favor selecciona otro día.", 'error');
        return;
    }

    // Verificar disponibilidad
    const disponibilidad = verificarDisponibilidadAdmin(fecha, hora);
    if (!disponibilidad.disponible) {
        showAlert(disponibilidad.mensaje, 'error');
        return;
    }

    const data = {
        id: String(Date.now()),
        nombre: document.getElementById("newResNombre").value.trim(),
        correo: document.getElementById("newResCorreo").value.trim(),
        telefono: document.getElementById("newResTelefono").value.trim(),
        fecha: fecha,
        hora: hora,
        personas: document.getElementById("newResPersonas").value,
        creado: new Date().toLocaleString()
    };

    if(!data.nombre || !data.correo || !data.telefono || !data.fecha || !data.hora){
        showAlert("Por favor completa todos los campos", 'error');
        return;
    }

    reservas.push(data);
    localStorage.setItem("reservas", JSON.stringify(reservas));
    closeModalNuevaReserva();
    render();
    showAlert("Reserva creada exitosamente");
};

/* ============================
   MODALES — NUEVO MENSAJE
============================ */
const modalNuevoMensaje = document.getElementById("modalNuevoMensaje");

function openNuevoMensaje(){
    document.getElementById("newMsgNombre").value = "";
    document.getElementById("newMsgCorreo").value = "";
    document.getElementById("newMsgTelefono").value = "";
    document.getElementById("newMsgTexto").value = "";

    modalNuevoMensaje.classList.add("show");
}

function closeModalNuevoMensaje(){
    modalNuevoMensaje.classList.remove("show");
}

document.getElementById("saveNuevoMensajeBtn").onclick = ()=>{
    const data = {
        id: String(Date.now()),
        nombre: document.getElementById("newMsgNombre").value.trim(),
        correo: document.getElementById("newMsgCorreo").value.trim(),
        telefono: document.getElementById("newMsgTelefono").value.trim(),
        mensaje: document.getElementById("newMsgTexto").value.trim(),
        creado: new Date().toLocaleString()
    };

    if(!data.nombre || !data.correo || !data.mensaje){
        showAlert("Por favor completa todos los campos obligatorios", 'error');
        return;
    }

    mensajes.push(data);
    localStorage.setItem("mensajesContacto", JSON.stringify(mensajes));
    closeModalNuevoMensaje();
    render();
    showAlert("Mensaje registrado exitosamente");
};

/* ============================
   BOTÓN NUEVO
============================ */
btnNew.onclick = ()=> {
    if(viewSelect.value === "reservas") openNuevaReserva();
    else openNuevoMensaje();
};

/* ============================
   EVENTOS
============================ */
viewSelect.onchange = render;
searchInput.oninput = render;

/* PRIMER RENDER */
render();
</script>

</body>
</html>